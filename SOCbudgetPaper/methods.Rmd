# Method (50)

We compile calculations as open-source R packages available at github.com/pik-piam/mrcommons (management related functions) and github.com/pik-piam/mrSOCbudget (soil dynamic related functions), which are both based on the MADRaT package (package citation?), a framework which aims to improve reproducibility and transparency in data processing.
In the following chapter we outine the most important relationships and assumptions. See table \@ref(append:subsection2mrfunctions) for further information on corresponding code within the R packages.


## Carbon Stocks following (new) Tier 2 method {#sec:carbonbudget}

Following the tier 2 approach of the refinement of IPCC guidelines vol. 4 (@ipcc_2019_2019; short Tier 2 steady-state method) , we estimate soil organic carbon (SOC) stocks for cropland and all other land represented by natural vegetation on half-degree resolution from 1975 to 2010. We assume the current SOC state converges towards a steady state, which itself is depending on biophysical, climatic and agronomic conditions. Therefore we conduct the following three steps within each yearly timestep: 
(1) We calculate annual land-use (sub-)type-specific steady states and decay rates for SOC stocks, 
(2) We account for land conversion by transferring SOC between land-use types and 
(3) We estimate SOC stocks based on the stocks of the previous time period, the steady state stocks and the decay rate. 

### Steady-state SOC stocks and decay rates

In a simple first order kinetic approach the steady-state soil organic carbon stocks $SOC^{eq}$ are given by 
\begin{equation}
SOC^{eq} =\frac{C^{\textrm{in}}}{k} \qquad\forall\quad i,t
(\#eq:inoutflow)
\end{equation}
with $C^{\textrm{in}}$ being carbon inputs to the soil, $k$ denoting the soil organic carbon decay rate; as well as $i$ representing grid cell indices and $t$ years. We use for our calculations the Tier 2 steady-state method, which assumes three soil carbon sub-pools (active, slow and passive) and interactions between them. Annual carbon inflow to each sub-pool and annual decay rates of each sub-pool are the key components to determining steady-state SOC stocks.

#### Carbon Inputs to the Soil {-}

We account for different carbon input sources depending on the two land-use types we distinguish, croplands and natural vegetation (see table \@ref(tab:datasourceinputs)). Carbon sources for cropland are recycled crop residues, below ground biomass of crops (for both see \@ref(sec:residues)) and recycled manure (see \@ref(sec:livst_manure)); for natural vegetation litterfall ([@LPJmL4_1]) litterfall is the only source of carbon.

Following the IPCC carbon accounting methodology, carbon inputs are disaggregated into metabolic and structural components depending on their lignin and nitrogen content (see \@ref(ipcc_2019_2019)). For each component the sum of all carbon input sources is allocated to the respective SOC sub-pools via transfer coefficients. This implies that both the amount of carbon as well as its structural composition determine the effective inflow. Data sources for all considered carbon inputs as well as for lignin and nitrogen content can be found in table \@ref(tab:datasourceinputs).  



```{=latex}

 \begin{table*}[h]
 \caption{Type and data sources for carbon inputs to different land-use types }
 \begin{tabular}{l l l l}
 \tophline
  \textbf{land-use types}   & \textbf{source of carbon inputs} & \textbf{data source} & \textbf{nitrogen and lignin content} \\
 \middlehline
 \multirow{3}{*}{Cropland} & residues & FAOSTAT, LPJmL4 [2, sec:residues] & default values given by [2]  \\
                            & dead below ground biomass of crops & FAOSTAT, LPJmL4 [2, sec:residues] & default values given by [2] \\
                            & manure & FAOSTAT, Isabelle [2, sec:manure] & default values given by [2] \\
                            \hline
  Natural vegetation        & annual litterfall & LPJmL4 [4]& \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut Nitrogen and lignin content of tree compartments used in CENTURY [4] \strut \end{minipage}\tabularnewline
 \bottomhline
 \end{tabular}
 \label{tab:datasourceinputs}
 \belowtable{}
 \end{table*}
```

<!-- add references here for the table-->

#### Soil Organic Carbon decay {-}

The sub-pool specific decay rates are influenced by climatic conditions, biophysical and biochemical soil properties as well as management factors that all vary over time (t) and space (i). Following the Tier 2 steady-state method we consider temperature (temp), water (wat), sand fraction (sf) and tillage (till) effects to account for spatial variation of decay rates. Thus $k_{sub}$ is given by

\begin{equation}
\begin{aligned}
& k_{active,t,i}  & = &~ k_{active}  ~ &\cdot~ temp_{t,i} ~ &\cdot~ wat_{t,i} ~ &\cdot~ till_{t,i} ~ & \cdot~ sf_{t,i}\\
& k_{slow,t,i}    & = &~ k_{slow}    ~ &\cdot~ temp_{t,i} ~ &\cdot~ wat_{t,i} ~ &\cdot~ till_{t,i} ~ &\\
& k_{passive,t,i} & = &~ k_{passive} ~ &\cdot~ temp_{t,i} ~ &\cdot~ wat_{t,i} ~ & ~ &
(\#eq:decayrates)
\end{aligned}
\end{equation}


For cropland we distinguish the effect of different tillage (see \@ref(#sec:tillage)) and irrigation (see \@ref(#sec:irrigation)) practices on decay rates, whereas for natural vegetation, we assume rainfed and non-tilled conditions. Data sources as well as drivers considered for each land-use types are shown in table \@ref(tab:datasourcedecay). To account for variations of decay rates within each grid cell due to different tillage and irrigation regimes, average rates based on area shares are calculated.

```{=latex}

 \begin{table*}[h]
 \caption{Type and data sources for carbon inputs to different land-use types}
 \begin{tabular}{l l l l}
 \tophline
  land-use types   & type of decay driver & parameter use to represent driver & data source \\
 \middlehline
 \multirow{2}{*}{all} & Soil quality & Sand fraction of the first 0-30 cm &  [SoilGrids]  \\
                      \cline{2-4}
                      
                      & Mircobial activity & air temperature & [CRUp4.0] \\
                      \cline{2-4}
                      
                      & Water restriction & precipitation \& potential evapotranspiration & [CRUp4.0] \\
                      \cline{1-4}
\multirow{2}{*}{\begin{minipage}[t]{0.2\columnwidth}\raggedright\strut Cropland\\(additionally)\strut\end{minipage}} & Water restriction*  & irrigation  & [sec:irrigation] \\ 
                      \cline{2-4}
                      
                      & Soil disturbance & tillage & [sec:tillage] \\
 \bottomhline
 \end{tabular}
 \belowtable{}
 (\#tab:datasourcedecay)
 \end{table*}
```

<!-- add references here for the table-->

### SOC transfer between land-use types

We calculate SOC stocks based on the area shares of land-use types (lut) within the half-degree grid cells (i). If land is converted from one land-use type into others (!lut), the respective share of the SOC stocks is reallocated. We account for land conversion at the beginning of each time step $t$ by calculating a preliminary stock $SOC_{lut,t*}$ via 

\begin{equation}
SOC_{lut,t*} = SOC_{lut,t-1} - \frac{SOC_{lut,t-1}}{A_{lut,t-1}} \cdot  AR_{lut,t} + \frac{SOC_{!lut,t-1}}{A_{!lut,t-1}} \cdot  AE_{lut,t} \qquad \forall\quad sub, i  
(\#eq:ctransfer)
\end{equation}

with $A$ being the area, $AR$ the area reduction and $AE$ the area expansion for a given land-use type $lut$. Note that $!lut$ denotes the sum over all other land-use types, which decreases in the specific time step $t$. Data sources and methodology on land-use states and changes are described in \@ref(sec:landuse). 

### Total SOC stocks

Carbon stocks $SOC$ for each sub-pool (sub) converge towards the calculated steady-state stock $SOC^{eq}$ for each land-use type (lut), each sub-pool (sub) and each annual time step (t) as represented in equation \@ref(eq:steadystate).

\begin{equation}
SOC_{t} = SOC_{t-1} + (SOC^{eq}_{t} - SOC_{t-1}) \cdot k_{t} \cdot 1\unit{a} \qquad \forall\quad\quad lut, sub, i.
(\#eq:SOCstate)
\end{equation}

Reformulating equation \@ref(eq:steadystate), we obtain a massbalance equation as follows

\begin{equation}
SOC_{t} = SOC_{t-1} - \underbrace{SOC_{t-1} \cdot k_{t} \cdot 1\unit{a}}_{\text{outflow}} + \overbrace{SOC^{eq}_{t} \cdot k_{t} \cdot 1\unit{a}}^{\text{input (using equation \@ref(eq:inoutflow))}}  \qquad \forall\quad lut, sub, i.
(\#eq:steadystate2budget)
\end{equation}

The global SOC stock for each time step can than be calculated via

\begin{equation}
SOC_{t} = \sum_{i} \underbrace{\sum_{lut} \overbrace{\sum_{sub} SOC_{lut, sub, t, i}.}^{\text{$SOC_{lut, t, i}$ -- land-use type specific SOC stock within cell}}}_{\text{$SOC_{t, i}$ -- total SOC stock within cell}}
(\#eq:totalstock)
\end{equation}

### Initialisation of SOC pools

To initialize all SOC sub-pools we assume that cropped land as well as natural vegetation are in a steady state for the specific configuration present within the initialization year 1961. We assume after a spin-up period of 15 years reliable results start from 1975 and improve over time, since dependency on the initial conditions will decrease.

\newpage

## Agricultural management data on 0.5 degree resolution {#sec:agrimanagement}

We compile country-specific FAO production and cropland statistics ([@FAOSTAT]) to a harmonized and consistent data set. The data is prepared in 5 year time steps from 1965 to 2010, which, together with the spin up phase, restricts our analysis to time span from 1975 to 2010. For all the following data, if not declared differently, we interpolate values linearly between the time steps and hold them constant before 1965.

### Landuse and Landuse Change (150) {#sec:landuse}

Land-use patterns are based on the Land-Use Harmonization 2 (LUH2, [@LUH2]) data set, which we aggregate from quarter degree to half degree resolution. We disaggregate the five different cropland subcategories (c3ann, c3per, c4ann, c4per, c3nfx) of LUH2 into our 17 crop groups, applying the relative shares for each gridcell based on the country and year specific area harvested shares of FAOSTAT data ([@FAOSTAT]) (see \@ref(append:Table_luh2fao2mag) for more  details on the crop group mapping). Land-use transitions are calculated as net area differences of the land-use data on half-degree.

### Crop and Crop Residues (300) {#sec:residues}

#### Crop Production {-}
Using half-degree yield data from LPJmL ([@LPJmL4_1]) as well as half-degree cropland patterns (see \@ref(#sec:landuse)) we compile crop group specific half-degree production patterns. We calibrate cellular yields with a country-level calibration factor for each crop group to meet historical FAOSTAT production ([@FAOSTAT]). Note that by using physical cropland areas we account for multiple crop harvest events as well as for fallows.

#### Crop Residue Production {-}
Crop residue production and management is based on a revised methodology of ([@bodirsky2012]) and key aspects are explained here given its central role for soil carbon modelling. Starting from harvested crop production ($CP$) estimates and their respective harvested crop area ($CA$), we estimate above-ground ($AGR$) and below-ground ($BGR$) residual biomass using crop group ($cg$) specific harvest indices ($HI$) and root:shoot ratios ($RS$) as follows  

\begin{equation}
\begin{aligned}
AGR & = CP \cdot HI_{\textrm{slope}} + CA \cdot HI_{\textrm{intercept}}\qquad & \textrm{and} \\
BGR & = (CP + AGR) \cdot RS \qquad                                            & \forall\quad cg, i, t.
(\#eq:resbiomass)
\end{aligned}
\end{equation}

Following the IPCC guidelines, we split the harvest index into a yield and an area dependend fraction ([@ipcc_2006_2006]). Note that deviating from [@bodirsky2012] we use harvested instead of physical crop area to account for increased residue biomass due to multiple cropping and decreased amounts on fallow land. 
We assume that all BGR are recycled to the soil, whereas AGR can be burned or harvested for other purposes such as feeding animals ([@weindl]), fuel or for material use.

##### Burned Residues {-}
A fixed share of the AGR is assumed to be burned on field depending on the per-capita income of the country. Following [@smil1999]) we assume 25% burn share for low-income countries according to worldbank definitions ($<\,1000\,\tfrac{USD}{yr\,cap}$), 15% for high-income  ($>\,10000\,\tfrac{USD}{yr\,cap}$) and linearly interpolate shares for all middle-income countries depending on their per-capita income. Depending on the crop group 80–90% of the residue carbon burned on the fields are lost within the combustion process ([@ipcc_2006_2006]).

##### Residue Usage {-}
We compile out of our 17 crop groups, three residue groups (straw, high-lignin and low-lignin residues) with additional demand for other purposes and one residue with no double use (see \@ref(append:Table_kcr2kres)). Residue feed demand for five different livestock groups is based on country- and residue-group-specific feed baskets (see [@weindl]), taking available AGR biomass as well as livestock productivity into account. We estimate, for low-income countries,  a material-use share for straw residues of 5% and a fuel-share of 10% for all used residues groups in low-income countries. For high-income countries, no withdrawal for material or fuel use is assumend, and middle-income countries use shares are linearly interpolated based on per-capita income. The remaining AGR as well as all BGR are assumend to be recycled to the soil. We limit high recycling shares at $10\tfrac{\unit{tC}}{\unit{ha}}$ to correct for outliers.

#### Dry Matter to Carbon Transformation {-}
To transform dry matter estimates into carbon, we compiled crop-group and plant part specific carbon to dry matter (c:dm) ratios (see \@ref(append:Table_c2dm)) (@Ma2018).


### Livestock Distribution and Manure Excretion	(300) {#sec:livst_manure}

We assume that manure is applied at its excretion place, leaving the livestock distribution the driving factor for the spatial pattern of manuring.

#### Livestock Distribution {-}
To disaggregate country level FAOSTAT livestock production values to the half-degree scale, we use the following rule-based assumptions, drawing from by the approach of [@gilbert], and uses feed basket assumptions based on a revised methodology from @weindl. We differentiate between ruminant and monogastric systems, as well as extensive and intensive systems.
For ruminants, we assume that livestock is located where the production of feed occurs. We distingush between grazed pasture, which is converted into livestock products from extensive systems; and all other (crop-based) feeds, which we consider to be consumend in intensive systems.
For poultry, egg and monogastric meat production we use the per-capita income of the country to divide between intensive and extensive production systems. For low-income countries, we assume extensive production systems. We locate them according to the share of built-up areas based on the idea that these animals are held in subsistence or small-holder farming systems with a high labour per animal ratio. Intensive production associated with higher income countries, is distributed within a country using again share of crop-based feed production,  assuming that feed availability is the most driving factor for livestock location.

#### Manure Excretion, Storage and Recycling {-}
Manure production and management is based on a revised methodology of ([@bodirsky2012]) and is presented here due to its central role in soil carbon modelling. Based on the gridded livestock distribution we calculate excretions by estimating the nitrogen balance of the livestock system on the basis of comprehensive livestock feed baskets ([@weindl]), assuming that all nitrogen in protein feed intake, minus the nitrogen in the slaughter mass, is excreted. Carbon in excreted manure is estimated by applying fixed C:N ratios (given by [(@ipcc_2019_2019)]). 
Depending on the feed system we assume manure to be handled in four different ways:
All manure orginated from pasture feed intake is excreted directly to pastures and rangelands (pasture grazing), deducting manure collected as fuel. Manure fuel shares are estimated using IPCC default values (@ippc_2006_2006). 
Whereas for low-income countries, we adopt a share of 25% of crop residues in feed intake directly consumend and excreted on crop fields (stubble grazing), we do not consider any stubble grazing in high-income countries; middle-income countries see linearly interpolated shares depending on their per-capita income.
For all other feed items we assume the manure to be stored in animal waste management systems associated with livestock housing. 
To estimate the carbon actually recycled to the soil, we account for carbon losses during storage and recycling shares in different animal waste management and grazing systems. Whereas we assume no losses for pasture and stubble grazing, we consider that the manure collected as fuel is not recycled. For manure stored in different animal waste management systems we compiled carbon loss rates partly depending on the nitrogen loss rates as specified in [@bodirsky2012] (see \@ref(append:Table_clossAWMS))). We limit high application shares at $10\tfrac{\unit{tC}}{\unit{ha}}$ to correct for outliers.

### Irrigation

We use irrigation area shares to modify the water effect on decomposition by weighting the irrigated and rainfed water factors based on these shares. The LUH2v2 data set provides irrigated fractions for their cropland subcategories. We apply aggregated area shares, leading to the same impact of irrigation on all of our crop groups. Moreover we assume the irrigation effect to be present for all 12 months of a year in grid cells, that has been marked as irrigated.

### Tillage

To account for the distribution of tillage of the three tillage types specfied by the IPCC - full tillage, reduced tillage and no tillage -, we assume that all natural land and pastures are not tilled, whereas annual crops are under full and perennials under reduced tillage. This rule is based on the approach of [@porvolik], but neglects the (less common) adoption of no-tillage farming on agricultural land. 


\newpage

## Carbon Budget following Tier 1 (150) {#sec:tier1}

Additionally to the tier 2 approach of the refinement of IPCC guidelines vol. 4 (@ipcc_2019_2019) and the detailed analysis of management data coming with it, SOC changes can be estimated using the IPCC tier 1 approach of IPCC guidelines vol. 4 (@ipcc_2006_2006, @ipcc_2019_2019). Here, stocks are calculated via stock change factors (SCF) given by the IPCC for the topsoil (0-30 cm) and based on observational data. SCF are differentiated by different crop and management systems ($m$) reflecting different dynamics under changed in- and outflows without explicitly tracking these. Moreover SCF vary for different climatic zones ($c$) specified by the IPCC (see \@ref(append:climatemap)). The actual SOC stocks as thus calulated based on a given reference SOC stock by

\begin{equation}
SOC^{\text{target}}_{i} = \sum_{c,m} T_{c,i} \cdot SOC^{\text{ref}} \cdot F_{\text{LU}_{c,m}} \cdot F_{\text{MG}_{c,m}} \cdot F_{\text{I}_{c,m}} \cdot A_{m,i} \qquad\forall\quad t,
(\#eq:tier1)
\end{equation}

with $T_{c,i}$ being the translation matrix for grid cells $i$ into corresponding climate zones $c$. For this analysis we us the default SCF as a comparison and constistency check for our more detailed budget approach.

According to [@ipcc_2019_2019] the formulation of absolute changes like
<!-- plugin absolute chnage equation of refinement cropland chapter -->
might be neccessary as well.

